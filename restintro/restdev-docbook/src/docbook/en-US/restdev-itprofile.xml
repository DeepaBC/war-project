<chapter id="maven-it-profile">
        <title>Maven Integration (IT) Profile</title>
        <para/>
        
        <section id="it-activation">
            <title>IT Profile Activation
            <footnote><para><ulink url="http://maven.apache.org/guides/introduction/introduction-to-profiles.html">Introduction to (Maven) Build Profiles</ulink></para></footnote>
            </title>
            <para>Activated if <code>src/it</code> directory exists</para>
<programlisting language="xml"><![CDATA[                    
<profile>
    <id>IT</id>
    <activation>
        <file>
            <exists>${basedir}/src/it</exists>
        </file>
    </activation>
    ...
</profile>
]]></programlisting>
        </section>

        <section id="it-default-properties">
            <title>IT Default Property Values</title>
            <para></para>
<programlisting language="xml"><![CDATA[                    
<properties>
    <!-- these values should be in your .m2/settings.xml -->
    <jboss.host>localhost</jboss.host>
    <jboss.servlet.port>8080</jboss.servlet.port>
    <jboss.mgmt.host>localhost</jboss.mgmt.host>
    <jboss.mgmt.port>9999</jboss.mgmt.port>
</properties>
]]></programlisting>
        </section>

        <section id="it-cargo">
            <title>Cargo Deployer</title>
            <para>Deploys and undeploys JavaEE components to application server</para>
<programlisting language="xml"><![CDATA[                    
<!-- General approach to deploy and undeploy application  -->
<plugin>
    <groupId>org.codehaus.cargo</groupId>
    <artifactId>cargo-maven2-plugin</artifactId>
    <configuration>
        <container>
            <containerId>jboss71x</containerId>
            <type>remote</type>
        </container>
        <configuration>
            <type>runtime</type>
            <properties>
                <cargo.hostname>${jboss.mgmt.host}</cargo.hostname>
                <cargo.jboss.management.port>${jboss.mgmt.port}</cargo.jboss.management.port>
            </properties>
        </configuration>
    </configuration>
    
    <dependencies>
        <dependency>
            <groupId>org.jboss.as</groupId>
            <artifactId>jboss-as-controller-client</artifactId>
            <version>${jboss7.version}</version>
        </dependency>
    </dependencies>
    
    <executions>
       <execution> <!-- deploy to server-->
           <id>cargo-deploy</id> 
               <phase>pre-integration-test</phase>
           <goals>
               <goal>redeploy</goal>
           </goals>
       </execution>
        <execution> <!--  undeploy from server -->
            <id>cargo-undeploy</id>
            <phase>post-integration-test</phase>
            <goals>
                <goal>undeploy</goal>
            </goals>
        </execution>
    </executions>
</plugin>
]]></programlisting>
        </section>

        <section id="it-failsafe">
            <title>Failsafe Plugin</title>
            <itemizedlist>
                <listitem><para>Runs <code>src/it/java/**/*IT.java</code> JUnit tests during <code>integration-phase</code></para></listitem>
                <listitem><para>Evaluates results during <code>verify</code> phase</para></listitem>
            </itemizedlist>
<programlisting language="xml"><![CDATA[                    
<!-- add failsafe plugin for IT testing -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-failsafe-plugin</artifactId>
    <configuration>
        <testSourceDirectory>src/it/java</testSourceDirectory>
        <includes>
            <include>**/*IT.java</include>
        </includes>
    </configuration>
    <executions>
        <execution> <!-- run the tests here -->
            <id>it</id> 
                <phase>integration-test</phase>
            <goals>
                <goal>integration-test</goal>
            </goals>
        </execution>
        <execution> <!--  delay failures to after undeploy -->
            <id>verify</id>
            <phase>post-integration-test</phase>
            <goals>
                <goal>verify</goal>
            </goals>
        </execution>
    </executions>
</plugin>
]]></programlisting>
            <note>
                <para></para>
                <itemizedlist>
                    <listitem><para>Surefire</para>
                        <itemizedlist>
                            <listitem><para>Automatically wired to run during test phase</para></listitem>
                            <listitem><para>Failure stops build</para></listitem>
                        </itemizedlist>
                    </listitem>
                    <listitem><para>Failsafe</para>
                        <itemizedlist>
                            <listitem><para>Manually wired to run tests during integration-test phase</para></listitem>
                            <listitem><para>Manually wired to evaluate results during verify phase</para></listitem>
                            <listitem><para>Delayed evaluation allows post-integration phase cleanup to occur before failing build</para></listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
            </note>
        </section>


        <section id="it-build-helper">
            <title>Adding Custom Source Directories to Build</title>
            
            <itemizedlist>
                <listitem><para>Integration source artifacts were separated from 
                    the <code>src/test</code> tree</para></listitem>
                <listitem><para>New/custom <code>src/it</code>
                    directories must be added to the build</para></listitem>
                <listitem><para>This takes care of both Maven and Eclipse</para></listitem>
            </itemizedlist>
<programlisting language="xml"><![CDATA[                    
<!-- add the custom src/it directories to maven build -->
<plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>build-helper-maven-plugin</artifactId>
    <executions>
       <execution>
           <id>add-it-tests</id>
           <phase>generate-test-sources</phase>
           <goals>
               <goal>add-test-source</goal>
           </goals>
           <configuration>
               <sources>
                   <source>src/it/java</source>
               </sources>
           </configuration>
       </execution>
       <execution>
           <id>add-it-resources</id>
           <phase>generate-test-resources</phase>
           <goals>
               <goal>add-test-resource</goal>
           </goals>
           <configuration>
               <resources>
                   <resource>
                       <directory>src/it/resources</directory>
                   </resource>
               </resources>
           </configuration>
       </execution>
    </executions>
</plugin>
]]></programlisting>
        </section>

</chapter>  
