<?xml version='1.0'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<book>
  <bookinfo>
    <title>Development Environment Setup</title>
    <abstract>
        <para>This document contains the setup instructions for downloading 
           and setting up the various applications, tools, and libraries used
           in class.
        </para> 
    </abstract>
  </bookinfo>
  
  <toc/> 
  
  <chapter id="end-to-end-environment">
    <title>The environment</title>
    <para>...these are all the pieces...</para>
  </chapter>
  
  <chapter id="git-client-setup">
    <title>Git Client Setup</title>
    <para>You will use Git in this class to perform an initial checkout and
    get updates for source files. Any Git client should be able to perform that
    function. You can determine if you have a command line Git client already 
    installed using the following simple command.
    </para>
    <programlisting><![CDATA[
//my ubuntu system
$ git --version
git version 1.7.0.4

//my win7/msysGit system
$ git --version
git version 1.7.5.GIT
]]></programlisting>           

        <section id="install-git-client">
            <title>Install Git Client</title>
            <para>There are a number of options and some
            are going to be based on on your platform. Your basic options
            include command line or using an Eclipse plugin</para>
            <itemizedlist>
                <listitem><para>Linux Command-Line Users: Either go to your 
                package installer or google the web to locate a suitable rpm
                for your system. Select git-core, gitk, and git-gui packages.</para>
                </listitem>
                <listitem><para>Cygwin Command-Line Users: Use the cygwin setup tool to locate
                the git packages</para></listitem>
                <listitem><para>Windows Command-Line Users: Git comes in a core 
                layer and then OS-layer add-ons. The core layer is sufficient for class
                and can be found at <ulink url="http://msysgit.github.com/">http://msysgit.github.com/</ulink></para>
                    <orderedlist>
                        <listitem><para>Download <ulink url="http://code.google.com/p/msysgit/downloads/list?q=full+installer+official+git">Full Installer</ulink></para></listitem>
                        <listitem><para>Accept the default installation option of 
                        "Use Git Bash bash only". As the prompt states, it has 
                        the least risk and will be suitable for the minor 
                        amount of use required in class.</para></listitem>
                        <listitem><para>Chose your checkout style. Don't 
                        worry about commit style you will only be performing 
                        read-only checkouts. I chose "Checkout as-is, 
                        commit Unix-style line endings" since I used all 
                        linux-style editors on Windows. You may want the 
                        Window checkout format.</para></listitem>
                        <listitem><para>Click on the "Git Bash" icon after 
                        the installation is complete.</para></listitem>
                    </orderedlist>
                </listitem>
                <listitem><para>Eclipse GUI Users: There is a git plugin for 
                Eclipse available called EGit. You can install it by going to 
                <code>Help->Eclipse Marketplace</code>, typing Git in the search 
                field, and clicking Install for EGit.</para></listitem>
            </itemizedlist>
        </section>    
        
        <section id="get-git-repo">
            <title>Get Class Repository</title>
            <para>The class repository is located on github and can be browsed 
            using the following http URL
            <ulink url="https://github.com/jcstaff/ejava-javaee">https://github.com/jcstaff/ejava-javaee</ulink>.
            With a cloned copy, you can receive file updates during the semester.
            </para>
            <note><para>TODO: update placeholder URL for Git repo</para></note>
            <orderedlist>
                <listitem><para>CD to a directory you wish to place source code.
                    Make sure the path to this directory contains no spaces.</para>
                </listitem>
                <listitem><para>Clone the class repository using the following
                URL <ulink url="git://github.com/jcstaff/ejava-javaee.git">git://github.com/jcstaff/ejava-javaee.git</ulink>
                </para>
    <programlisting><![CDATA[
$ git clone git://github.com/jcstaff/ejava-javaee.git
Cloning into 'ejava-javaee'...
remote: Counting objects: 14459, done.
remote: Compressing objects: 100% (5064/5064), done.
remote: Total 14459 (delta 6582), reused 14351 (delta 6474)
Receiving objects: 100% (14459/14459), 15.91 MiB | 805 KiB/s, done.
Resolving deltas: 100% (6582/6582), done.

$ ls
ejava-javaee

$ cd ejava-javaee
$ git branch
* master

$ git branch -a
* master
]]></programlisting>                          
                </listitem>
                <listitem><para>Perform a mock update. This is what you will
                    be doing several times this semester to get file updates.</para>
    <programlisting><![CDATA[
$ git pull
]]></programlisting>                          
                </listitem>
            </orderedlist>
            <note><para>TODO: update placeholder URLs for Git repo</para></note>
        </section>
  </chapter>
  
  <chapter id="maven-env-setup">
    <title>Maven Environment Setup</title>
        <para></para>
        
        <section id="maven-core-setup">
            <title>Maven Core Setup</title>
            <para></para>
        </section>

        <section id="maven-proxy-setup">
            <title>Maven Proxy Setup</title>
            <para>In the previous section we installed and setup Maven
                in a stand-alone client mode. In that mode the individual 
                environment communicated directly with the external Internet
                organizations to obtain missing artifacts. In this section
                we will add a proxy server between the developer and the
                Internet so that one or more developers can share what has
                already been downloaded and be completely isolated from 
                network and remote outages. Ideally this proxy would be placed
                on a shared server somewhere on your local intranet with
                access to the outside Internet. The instructions will act
                as though you are installing it locally. It is your decision
                whether to use it and where to install it. If you do not 
                install and configure a proxy -- you will notice small delays
                in your builds while your local maven client checks Internet 
                sources for new artifacts and updates to existing artifacts.
             </para>
             
             <section id="nexus-setup">
                <title>Nexus OS Setup</title>
                 <para>
                    We will be using Sonatype's Nexus OSS for our repository.
                    You have at least 3 options.
                    <orderedlist>
                        <listitem><para>Manually setup the server from an Internet download.
                           This allows you to best know what I have and have
                           not customized for class. Artifacts will be 
                           discovered by your instance once setup is complete.</para></listitem>
                        <listitem><para>Download a server I have pre-configured.
                           The pre-configured server and pre-populated repository
                           will be part of the download. This should come out-of-the-box
                           ready to use but still allow you to customize.</para></listitem>
                        <listitem><para>Share an proxy with someone who already
                           has one up and running on your network. This is the 
                           primary way Maven proxies are intended to be used.</para></listitem>
                    </orderedlist>
                 </para>

                 <section id="nexus-manual-setup">
                    <title>Nexus OSS Manual Setup</title>
                    <para>This procedure will take you through a manual download
                        and setup of the Nexus OSS software and have you go thru
                        a manual setup of all items. Use this approach if you 
                        want a minor amount of experience in setting up the sever.
                    </para>
                    <orderedlist>
                        <listitem><para>Download the Nexus OSS Software from Sonatype
                            <ulink url="http://www.sonatype.org/nexus/go">http://www.sonatype.org/nexus/go</ulink>
                            </para>
                        </listitem>
                        <listitem><para>Unzip the the compressed file to your filesystem.
                        There will be two directories created; one for the software
                        (<code>nexus-(version)</code>) and another for the repository
                        caches (<code>sonatype-work</code>)
                        </para>
                    <programlisting><![CDATA[
$ ls nexus-2.0.3/ sonatype-work/
nexus-2.0.3/:
bin  conf  lib  LICENSE.txt  logs  nexus  NOTICE.txt  tmp

sonatype-work/:
nexus  README.txt
    ]]></programlisting>           
                        </listitem>
                        
                        <listitem><para>The server will listen on port 8081 on 
                            all interfaces (0.0.0.0) by default. Modify
                            <code>nexus-2.0.3/conf/nexus.properties</code> if 
                            you want something different.</para>
                    <programlisting><![CDATA[
$ more nexus-2.0.3/conf/nexus.properties                                                                                                                                       
...
# Jetty section
application-port=8081
application-host=0.0.0.0
...
    ]]></programlisting>                        
                        </listitem>        
                        <listitem><para>Locate the startup script in the NEXUS_HOME/bin
                            directory. </para>
                    <programlisting><![CDATA[
$ ls nexus-2.0.3/bin/
jsw  nexus  nexus.bat                 
    ]]></programlisting>
                        <tip>
                            <para>Linux users might want to register this script
                            in /etc/init.d. If you also configure it to automatically
                            start at boot -- supply a value for <code>RUN_AS_USER</code>
                            to keep the server from running as root.</para>
                        </tip>                        
                        </listitem>
                        <listitem><para>Use the script appropriate for your platform
                            to start and perform other controls on the server.
                            </para>
                    <programlisting><![CDATA[
$ nexus-2.0.3/bin/nexus
Usage: nexus-2.0.3/bin/nexus { console | start | stop | restart | status | dump }

$ nexus-2.0.3/bin/nexus start
Starting Nexus OSS...
Started Nexus OSS.
    ]]></programlisting>                        
                        </listitem>
                        <listitem><para>Access the Web UI for Nexus OSS
                            <ulink url="http://localhost:8081/nexus">http://localhost:8081/nexus</ulink>
                        </para></listitem>                    
                        <listitem><para>Login with the default account of admin/admin123</para></listitem>
                        <listitem><para>Change the admin password using Security-&gt;Change Password</para></listitem>
                        <listitem><para>Add remote repositories</para>
                            <orderedlist>
                                <listitem><para>Click on Views/Repositories-&gt;Repositories</para></listitem>
                                <listitem><para>Click the +Add...Proxy Repository</para></listitem>
                                <listitem><para>Fill in the data for the repositories in the 
                                    following Repositories table. Use default values for 
                                    anything not included in the table.</para></listitem>
                                <listitem><para>Press Save</para></listitem>
                            </orderedlist>
                            <table frame="all"><title>Repositories</title>
                                <tgroup cols="4">
                                <thead>
                                    <row>
                                        <entry>Repository ID</entry>
                                        <entry>Repository Name</entry>
                                        <entry>Repository Policy</entry>
                                        <entry>Remote Storage Location</entry>
                                    </row>
                                </thead>
                                <tbody>
                                    <row>
                                        <entry>jboss-nexus</entry>
                                        <entry>JBoss Nexus</entry>
                                        <entry>Release</entry>
                                        <entry><ulink url="https://repository.jboss.org/nexus/content/repositories/releases/">https://repository.jboss.org/nexus/content/repositories/releases/</ulink></entry>
                                    </row>
                                    <row>
                                        <entry>exoplatform</entry>
                                        <entry>Exoplatform</entry>
                                        <entry>Release</entry>
                                        <entry><ulink url="http://maven2.exoplatform.org/maven/">http://maven2.exoplatform.org/maven/</ulink></entry>
                                    </row>
                                    <row>
                                        <entry>ejava-nexus</entry>
                                        <entry>EJava Nexus</entry>
                                        <entry>Release</entry>
                                        <entry><ulink url="http://ejava.info/nexus/content/repositories/releases/">http://ejava.info/nexus/content/repositories/releases/</ulink></entry>
                                    </row>
                                </tbody>
                                </tgroup>
                            </table>
                            <note>
                                <para>Nexus will take several minutes to contact the 
                                repositories just configured and get index information.
                                You must wait for this to complete before advancing to the 
                                "Public Repositories" step. However, you can jump forward
                                to "Integrate Proxy with Maven" while this is taking place.
                                Please allow for at least 15min. You will know that it is 
                                complete by either by seeing no active tasks in the 
                                "Admin-&gt;Scheduled Tasks" display. There are also 
                                some RSS feeds that can be used for monitoring.
                                </para>
                                <para>With that said -- I have found I cannot get 
                                Nexus to move a new repository from the new state
                                to the Available state without restarting the server.
                                If after waiting for roughly 15min, you do not
                                see an indexing task running, and you do not see 
                                the above repositories in the Available repository
                                column mentioned in the next step -- restart your 
                                nexus server.
                                </para>
                    <programlisting><![CDATA[
$ service nexus restart
Stopping Nexus OSS...
Stopped Nexus OSS.
Starting Nexus OSS...
Started Nexus OSS.
    ]]></programlisting>                        
                            </note>
                        </listitem>
                        <listitem><para>Add the created repositories to the Public Repositories</para>
                            <orderedlist>
                                <listitem><para>Select <code>Public Repositories</code> line
                                    towards the top of the repositories list.</para></listitem>
                                <listitem><para>Select repositories form the right Available
                                column and add them to the left column. Specify them last
                                in the following order</para>
                                <orderedlist>
                                    <listitem><para>JBoss Nexus</para></listitem>
                                    <listitem><para>Exoplatform</para></listitem>
                                    <listitem><para>Ejava Nexus</para></listitem>
                                </orderedlist>
                                </listitem>
                                <listitem><para>Press Save</para></listitem>
                            </orderedlist>
                        </listitem>
                    </orderedlist>
                 </section>
             </section>
             
             <section id="integrate-proxy-with-maven.xml">
                <title>Integrate Proxy with Maven</title>
                <orderedlist>
                    <listitem><para>Add the following to the <code>.m2/settings.xml</code> file
                        in your HOME directory to enable use of the proxy</para>
                <programlisting language="xml"><![CDATA[
<?xml version="1.0"?>
<settings xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">

    <mirrors>
        <mirror>
          <id>nexus</id>
          <mirrorOf>*</mirrorOf>
          <url>http://localhost:8081/nexus/content/groups/public</url>
        </mirror>
    </mirrors>

    </profiles>
        <profile>
          <!-- this config is straight out of the nexus manual -->
          <id>nexus</id>
          <repositories>
            <repository>
              <id>central</id>
              <url>http://central</url>
              <releases>
                  <enabled>true</enabled>
              </releases>
              <snapshots>
                  <enabled>true</enabled>
              </snapshots>
            </repository>
          </repositories>
         <pluginRepositories>
            <pluginRepository>
              <id>central</id>
              <url>http://central</url>
              <releases>
                  <enabled>true</enabled>
              </releases>
              <snapshots>
                  <enabled>true</enabled>
              </snapshots>
            </pluginRepository>
          </pluginRepositories>
        </profile>
    </profiles>
    
    <activeProfiles>
        <activeProfile>nexus</activeProfile>
    </activeProfiles>
</settings>    
]]></programlisting>                        
                    </listitem>
                    <listitem><para>Test your configuration using </para>
                <programlisting><![CDATA[
$ mvn clean install
[INFO] Scanning for projects...
Downloading: http://localhost:8081/nexus/content/groups/public/org/eclipse/wst/css/core/maven-metadata.xml
Downloaded: http://localhost:8081/nexus/content/groups/public/org/eclipse/wst/css/core/maven-metadata.xml (376 B at 0.4 KB/sec)
]]></programlisting>                        
                    </listitem>
                    <listitem>
                        <para>If you have Eclipse installed at this point, have 
                        it re-process your settings.xml by going to
                        <code>Window-&gt;Preferences-&gt;Maven-&gt;User Settings-&gt;Update Settings</code></para>
                    </listitem>                    
                </orderedlist>
             </section>
        </section>
  </chapter>
</book>
